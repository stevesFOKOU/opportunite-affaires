<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Publier une annonce - Opportunité d'affaires</title>
  <link rel="icon" href="assets/images/logo.png" type="image/png">
  <link rel="stylesheet" href="css/style-modern.css">
  <link rel="stylesheet" href="css/responsive-modern.css">
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="container header-inner">
      <a href="index.html" class="logo">
        <img src="assets/images/logo.png" alt="Logo">
        <span>Opportunité d'affaires</span>
      </a>

      <nav class="nav">
        <a href="index.html" class="nav-link">Accueil</a>
        <a href="properties.html" class="nav-link">Annonces</a>
        <a href="agencies.html" class="nav-link">Agences</a>
        <a href="submit.html" class="nav-link">Publier</a>
      </nav>

      <div class="nav-actions">
        <div class="auth-buttons">
          <a href="login.html" class="btn btn-outline">Se connecter</a>
        </div>
        <div class="user-menu" style="display: none;">
          <span class="user-name"></span>
          <button class="btn btn-ghost logout-btn">Déconnexion</button>
        </div>
      </div>

      <button class="menu-toggle" aria-label="Menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main style="padding-top: 90px;">
    <div class="container section">
      
      <!-- Auth Required Message -->
      <div id="auth-required" class="card" style="max-width: 500px; margin: 0 auto; display: none;">
        <div class="card-body text-center">
          <div style="margin-bottom: 20px;"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--gray)" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg></div>
          <h2>Connexion requise</h2>
          <p class="text-gray mt-1 mb-2">
            Vous devez être connecté pour publier une annonce.
          </p>
          <a href="login.html?redirect=submit.html" class="btn btn-primary">Se connecter</a>
        </div>
      </div>

      <!-- Submit Form -->
      <div id="submit-form-container" style="display: none;">
        <div class="mb-3">
          <h1 class="section-title">Publier une annonce</h1>
          <p class="section-subtitle">Remplissez le formulaire pour soumettre votre bien à la validation</p>
        </div>

        <form id="submit-form">
          
          <!-- Section 1: Informations de base -->
          <div class="form-section">
            <h3 class="form-section-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
              Informations du bien
            </h3>

            <div class="form-group">
              <label class="form-label">Titre de l'annonce <span class="required">*</span></label>
              <input type="text" name="title" class="form-input" placeholder="Ex: Villa 4 pièces avec piscine à Bastos" required>
              <span class="form-hint">Un titre clair et descriptif attire plus de visiteurs</span>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Type de bien <span class="required">*</span></label>
                <select name="type" class="form-select" required>
                  <option value="">-- Sélectionner --</option>
                  <option value="apartment">Appartement</option>
                  <option value="house">Maison / Villa</option>
                  <option value="land">Terrain</option>
                  <option value="commercial">Local commercial</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Prix (FCFA) <span class="required">*</span></label>
                <input type="number" name="price" class="form-input" placeholder="25 000 000" min="0" required>
              </div>

              <div class="form-group">
                <label class="form-label">Superficie (m²)</label>
                <input type="number" name="surfaceM2" class="form-input" placeholder="500" min="0">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Description détaillée <span class="required">*</span></label>
              <textarea name="description" class="form-textarea" rows="6" placeholder="Décrivez votre bien en détail : nombre de pièces, équipements, état, environnement..." required></textarea>
              <span class="form-hint">Minimum 50 caractères. Plus votre description est complète, plus vous aurez de contacts.</span>
            </div>
          </div>

          <!-- Section 2: Localisation -->
          <div class="form-section">
            <h3 class="form-section-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
              Localisation
            </h3>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Région <span class="required">*</span></label>
                <select name="region" class="form-select" required>
                  <option value="">-- Sélectionner --</option>
                  <option value="Centre">Centre</option>
                  <option value="Littoral">Littoral</option>
                  <option value="Ouest">Ouest</option>
                  <option value="Sud">Sud</option>
                  <option value="Est">Est</option>
                  <option value="Nord">Nord</option>
                  <option value="Adamaoua">Adamaoua</option>
                  <option value="Extrême-Nord">Extrême-Nord</option>
                  <option value="Nord-Ouest">Nord-Ouest</option>
                  <option value="Sud-Ouest">Sud-Ouest</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Ville <span class="required">*</span></label>
                <input type="text" name="city" class="form-input" placeholder="Yaoundé, Douala, Bafoussam..." required>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Adresse / Quartier</label>
              <input type="text" name="address" class="form-input" placeholder="Ex: Quartier Bastos, près du carrefour Nlongkak">
              <span class="form-hint">Précisez le quartier et les repères pour faciliter la localisation</span>
            </div>
          </div>

          <!-- Section 3: Photos -->
          <div class="form-section">
            <h3 class="form-section-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
              Photos du bien
            </h3>

            <div class="form-group">
              <label class="form-label">Ajouter des photos</label>
              <div class="file-upload-area" id="file-upload-area">
                <input type="file" name="photos" id="photos-input" accept="image/*" multiple style="display: none;">
                <div class="file-upload-content" onclick="document.getElementById('photos-input').click()">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--gray)" stroke-width="1.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                  <p style="margin-top: 15px; font-weight: 600; color: var(--dark);">Cliquez pour ajouter des photos</p>
                  <p style="font-size: 0.875rem; color: var(--gray); margin-top: 5px;">ou glissez-déposez vos fichiers ici</p>
                  <p style="font-size: 0.8rem; color: var(--gray); margin-top: 10px;">JPG, PNG, WebP • Max 8 photos • 5 MB chacune</p>
                </div>
              </div>
            </div>

            <div id="photos-preview" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 15px;"></div>
          </div>

          <!-- Section 4: Validation -->
          <div class="form-section" style="background: var(--white); border: 2px solid var(--gray-light);">
            <div class="form-group" style="margin-bottom: 0;">
              <label class="form-checkbox" style="padding: 10px; background: var(--light); border-radius: var(--radius-sm);">
                <input type="checkbox" name="terms" required>
                <span>J'accepte les <a href="#" style="color: var(--primary); text-decoration: underline;">conditions générales d'utilisation</a> et je certifie que les informations fournies sont exactes. <span class="required">*</span></span>
              </label>
            </div>

            <!-- Submit -->
            <div class="mt-3">
              <button type="submit" class="btn btn-primary btn-lg">
                Soumettre pour validation
              </button>
            </div>

          </div>
        </form>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-bottom">
        <p class="footer-copyright">© 2024 Opportunité d'affaires. Tous droits réservés.</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/app.js"></script>
  <script src="js/auth.js"></script>
  <script>
    // Vérifier l'authentification
    document.addEventListener('DOMContentLoaded', () => {
      if (App.isLoggedIn()) {
        document.getElementById('auth-required').style.display = 'none';
        document.getElementById('submit-form-container').style.display = 'block';
      } else {
        document.getElementById('auth-required').style.display = 'block';
        document.getElementById('submit-form-container').style.display = 'none';
      }
    });

    // Preview des photos
    document.getElementById('photos-input').addEventListener('change', (e) => {
      const preview = document.getElementById('photos-preview');
      preview.innerHTML = '';

      const files = Array.from(e.target.files).slice(0, 8);
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const div = document.createElement('div');
          div.className = 'card';
          div.style.overflow = 'hidden';
          div.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 80px; object-fit: cover;">`;
          preview.appendChild(div);
        };
        reader.readAsDataURL(file);
      });
    });

    // Soumission du formulaire
    document.getElementById('submit-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const form = e.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;

      submitBtn.disabled = true;
      submitBtn.innerHTML = '⏳ Envoi en cours...';

      try {
        const formData = new FormData(form);
        
        // Ajouter la devise par défaut
        formData.append('currency', 'XAF');

        const response = await apiRequestFormData('/properties', formData);

        showNotification('Annonce soumise avec succès ! Elle sera visible après validation.', 'success');
        
        setTimeout(() => {
          window.location.href = 'properties.html';
        }, 2000);

      } catch (error) {
        showNotification(error.message || 'Erreur lors de la soumission', 'error');
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }
    });
  </script>

</body>
</html>
